<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Lisa Pro ‚Äì Einstellungen</title>
    <link rel="stylesheet" href="/pico.min.css" />
    <style>
      :root {
        --accent: #ef4444;
        --accent-2: #dc2626;
        --glass: rgba(20, 20, 22, 0.42);
        --glass-strong: rgba(20, 20, 22, 0.62);
        --muted: rgba(255, 255, 255, 0.06);
        --border: rgba(255, 255, 255, 0.18);
        --text: #e5e7eb;
        --text-dim: #cbd5e1;
        --ok: #22c55e;
        --warn: #f59e0b;
        --err: #ef4444;
        --radius: 18px;
        --pico-background-color: transparent;
        --pico-card-background-color: transparent;
      }
      html, body { height: 100%; }
      body {
        position: relative;
        color: var(--text);
        background: transparent;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background: #0b0b0c;
        z-index: -1;
      }
      
      article {
        background: var(--glass);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        margin-bottom: 1.5rem;
        backdrop-filter: blur(3px);
      }
      article > header {
        background: var(--glass-strong);
        border-bottom: 1px solid var(--border);
        border-radius: var(--radius) var(--radius) 0 0;
        padding: 0.75rem 1rem;
      }
      h2, h3, h4 { color: var(--text); margin: 0; }
      
      .content { padding: 1rem; }
      .hidden { display: none !important; }
      
      h4 { 
        color: var(--accent); 
        margin-top: 1.5rem; 
        margin-bottom: 0.75rem; 
        text-transform: uppercase; 
        font-size: 0.85rem; 
        font-weight: 700;
        letter-spacing: 0.05em; 
      }
      
      input:not([type="checkbox"]), select {
        background: rgba(255, 255, 255, 0.02) !important;
        border: 1px solid var(--border) !important;
        color: var(--text) !important;
        border-radius: var(--radius) !important;
      }
      input:not([type="checkbox"]):focus, select:focus {
        border-color: var(--accent) !important;
      }

      button, [role="button"], .button {
        background: rgba(20, 20, 22, 0.42);
        color: var(--text);
        border: 1px solid var(--border);
        font-weight: 700;
        font-size: 1rem;
        line-height: 1.2;
        padding: 0.55rem 0.9rem;
        border-radius: var(--radius) !important;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        justify-content: center;
        text-decoration: none !important;
      }
      button:hover, [role="button"]:hover, .button:hover { background: rgba(255, 255, 255, 0.06); color: #fff; text-decoration: none !important; }
      button.primary, .primary { background: var(--accent) !important; color: #fff !important; border-color: var(--accent) !important; text-decoration: none !important; }
      button.secondary, .secondary { border-color: var(--accent); color: var(--accent); text-decoration: none !important; }

      input[type="checkbox"] {
        width: 1.1rem;
        height: 1.1rem;
        accent-color: var(--accent);
        margin-right: 0.5rem;
        cursor: pointer;
      }
      
      label {
        display: inline-flex;
        align-items: center;
        cursor: pointer;
        margin-bottom: 0.25rem;
      }

      hr { opacity: 0.15; margin: 1.5rem 0; }
      
      .grid { display: grid; grid-template-columns: 1fr; gap: 1rem; margin-bottom: 1rem; }
      @media(min-width: 768px) { .grid { grid-template-columns: 1fr 1fr; } }
      
      footer.card-footer {
        display: flex;
        gap: 0.5rem;
        padding: 0.75rem 1rem;
        border-top: 1px solid var(--border);
      }

      .config-block {
        background: rgba(0,0,0,0.15);
        padding: 1rem;
        border-radius: var(--radius);
        border: 1px solid var(--border);
      }

      /* Desktop-Optimierung */
      @media (min-width: 1024px) {
        main.container {
          max-width: 900px !important;
          margin: 2rem auto !important;
        }
        html { font-size: 15px; }
        article > header h2 { font-size: 1.25rem !important; }
        h4 { margin-top: 1rem; margin-bottom: 0.5rem; }
        button, [role="button"], .button { 
          font-size: 0.85rem !important; 
          padding: 0.4rem 0.8rem !important; 
        }
        input:not([type="checkbox"]), select {
          padding: 0.35rem 0.6rem !important;
          font-size: 0.9rem !important;
          height: auto !important;
        }
      }
    </style>
  </head>
  <body>
    <main class="container">
      <article>
        <header>
          <h2>Einstellungen</h2>
        </header>
        <div class="content">
          <form id="netForm">
            <h4>Allgemein</h4>
            <div style="display: flex; gap: 0.5rem; align-items: flex-end; margin-bottom: 1rem; flex-wrap: wrap;">
              <div style="flex: 1; min-width: 200px;">
                <label style="font-size: 0.75rem; color: var(--text-dim); margin-bottom: 0.2rem;">Ger√§tename (max. 10 Zeichen)</label>
                <input id="deviceName" name="name" maxlength="10" placeholder="z.B. LisaPro-1" style="margin:0;" />
              </div>
              <button type="button" id="btnNameSave" class="primary" style="margin:0;">Speichern</button>
            </div>

            <hr />

            <h4>WLAN Konfiguration</h4>
            <div style="display: flex; gap: 0.5rem; align-items: flex-end; margin-bottom: 1rem; flex-wrap: wrap;">
              <div style="flex: 1; min-width: 200px;">
                <label style="font-size: 0.75rem; color: var(--text-dim); margin-bottom: 0.2rem;">Netzwerk (SSID)</label>
                <div style="display:flex; gap:0.5rem;">
                  <select id="wifiSSID" name="ssid" style="flex:1; margin:0">
                    <option value="" disabled selected>Suche Netzwerke...</option>
                  </select>
                  <input id="ssidManual" placeholder="Manuelle SSID" class="hidden" style="flex:1; margin:0" />
                </div>
              </div>
              <button type="button" id="btnScan" style="margin:0;">WLAN Scan</button>
            </div>
            
            <div class="grid">
              <div>
                <label style="font-size: 0.75rem; color: var(--text-dim); margin-bottom: 0.2rem;">Passwort</label>
                <input id="pass" name="pass" type="password" placeholder="********" style="margin:0;" />
              </div>
              <div style="display: flex; align-items: center; padding-top: 1rem;">
                <label style="margin:0;"><input type="checkbox" id="showPass" /> Passwort anzeigen</label>
              </div>
            </div>

            <div style="margin: 1rem 0;">
              <label><input type="checkbox" id="useStatic" name="useStatic" role="switch" /> Statische IP-Adresse verwenden</label>
            </div>

            <div id="staticBlock" class="config-block hidden" style="border-left: 3px solid var(--accent);">
              <div class="grid">
                <div>
                  <label style="font-size: 0.75rem; color: var(--text-dim); margin-bottom: 0.2rem;">IP-Adresse</label>
                  <input id="ip" name="ip" placeholder="192.168.1.50" style="margin:0;" />
                </div>
                <div>
                  <label style="font-size: 0.75rem; color: var(--text-dim); margin-bottom: 0.2rem;">Subnetzmaske</label>
                  <input id="mask" name="mask" placeholder="255.255.255.0" style="margin:0;" />
                </div>
                <div>
                  <label style="font-size: 0.75rem; color: var(--text-dim); margin-bottom: 0.2rem;">Gateway</label>
                  <input id="gw" name="gw" placeholder="192.168.1.1" style="margin:0;" />
                </div>
                <div>
                  <label style="font-size: 0.75rem; color: var(--text-dim); margin-bottom: 0.2rem;">DNS (optional)</label>
                  <input id="dns" name="dns" placeholder="1.1.1.1" style="margin:0;" />
                </div>
              </div>
            </div>
            
            <div style="display:flex; justify-content:flex-end; margin-top: 1rem;">
              <button type="button" id="btnNetSave" class="primary">WLAN Einstellungen & Reboot</button>
            </div>

            <hr />
            
            <h4>Benachrichtigungen</h4>
            <div style="margin-bottom: 1rem;">
              <label><input type="checkbox" id="notifyEnabled" role="switch" /> WhatsApp Benachrichtigungen (CallMeBot)</label>
            </div>
            
            <div id="notifyBlock" class="config-block hidden" style="border-left: 3px solid var(--ok);">
              <div class="grid">
                <div>
                  <label style="font-size: 0.75rem; color: var(--text-dim); margin-bottom: 0.2rem;">Telefonnummer (+49...)</label>
                  <input id="notifyPhone" placeholder="+49XXXXXXXXXX" style="margin:0;" />
                </div>
                <div>
                  <label style="font-size: 0.75rem; color: var(--text-dim); margin-bottom: 0.2rem;">API-Key</label>
                  <input id="notifyKey" placeholder="1234567" style="margin:0;" />
                </div>
              </div>
              <div style="display:flex; gap:0.5rem; justify-content: flex-end; margin-top: 0.5rem;">
                <button id="btnNotifyTest" type="button">Test-Nachricht</button>
                <button id="btnNotifySave" type="button" class="primary">Speichern</button>
              </div>
            </div>

            <hr />

            <h4>MQTT & Home Assistant</h4>
            <div style="margin-bottom: 1rem;">
              <label><input type="checkbox" id="mqttEnabled" role="switch" /> MQTT aktivieren</label>
            </div>

            <div id="mqttBlock" class="config-block hidden" style="border-left: 3px solid #3b82f6;">
              <div class="grid">
                <div>
                  <label style="font-size: 0.75rem; color: var(--text-dim); margin-bottom: 0.2rem;">Broker (IP/Host)</label>
                  <input id="mqttServer" placeholder="192.168.1.10" style="margin:0;" />
                </div>
                <div>
                  <label style="font-size: 0.75rem; color: var(--text-dim); margin-bottom: 0.2rem;">Port</label>
                  <input id="mqttPort" type="number" placeholder="1883" value="1883" style="margin:0;" />
                </div>
                <div>
                  <label style="font-size: 0.75rem; color: var(--text-dim); margin-bottom: 0.2rem;">Benutzer</label>
                  <input id="mqttUser" placeholder="optional" style="margin:0;" />
                </div>
                <div>
                  <label style="font-size: 0.75rem; color: var(--text-dim); margin-bottom: 0.2rem;">Passwort</label>
                  <input id="mqttPass" type="password" placeholder="optional" style="margin:0;" />
                </div>
              </div>
              <div style="display:flex; justify-content: flex-end; margin-top: 0.5rem;">
                <button id="btnMqttSave" type="button" class="primary">Speichern</button>
              </div>
            </div>

            <hr />
          </form>
        </div>
        <footer class="card-footer">
          <a href="/" class="button" style="flex: 1;">Abbrechen</a>
          <button id="btnSetup" class="secondary" style="flex: 1;">Inbetriebnahme Assistent starten</button>
        </footer>
      </article>

      <footer class="site" style="padding: 0.9rem 1.1rem; background: var(--glass); border: 1px solid var(--border); border-radius: var(--radius); backdrop-filter: blur(3px); margin-bottom: 1.5rem;">
        <small style="display:block">&copy; 2026 Martin Teske ‚Äì Alle Rechte vorbehalten.</small>
        <small style="display:block">
          <strong>LuminaGrowX</strong> ist eine kostenlose Software von 
          <a href="https://martinteske-blog.de" target="_blank">MartinTeske-Blog.de</a>, 
          entwickelt f√ºr die <strong>LisaPro Growbox</strong>.
          <br>
          Die LisaPro Growbox ist exklusiv erh√§ltlich bei 
          <a href="https://mutualgarden.de" target="_blank">MutualGarden.de</a>.
        </small>
        <small style="display:block"><span id="apInfo" class="mono"></span></small>
      </footer>
    </main>

    <!-- Dialog: Inbetriebnahme Best√§tigung -->
    <dialog id="dlgSetupConfirm" class="modal">
      <article style="max-width: 600px;">
        <header>
          <h3>Inbetriebnahme Assistent</h3>
        </header>
        <div class="content" style="padding: 1rem;">
          <p>Du bist dabei, den Einrichtungsassistenten neu zu starten. Dies ist n√ºtzlich, um:</p>
          <ul>
            <li>Die Growbox in einem <strong>neuen WLAN</strong> anzumelden.</li>
            <li>Hardware-Komponenten (ToF-Abstand, RTC-Uhrzeit) erneut zu <strong>kalibrieren</strong>.</li>
          </ul>
          <div style="background: rgba(0,0,0,0.2); padding: 0.75rem; border-radius: 12px; font-size: 0.85rem; border-left: 3px solid var(--accent);">
            <strong>Ablauf:</strong> Das Ger√§t startet neu und er√∂ffnet ein eigenes WLAN-Netzwerk f√ºr die Einrichtung. Deine Grow-Daten (Tag, Sorte) bleiben erhalten.
          </div>
          <p style="margin-top: 1rem;">M√∂chtest du den Neustart jetzt ausf√ºhren?</p>
        </div>
        <footer style="display:flex; gap: 0.5rem; justify-content:flex-end; padding:.75rem 1rem;">
          <button class="secondary" onclick="$('dlgSetupConfirm').close()">Abbrechen</button>
          <button class="primary" id="btnConfirmSetupRun">Neustarten & Setup starten</button>
        </footer>
      </article>
    </dialog>

    <dialog id="toast" class="modal">
      <article>
        <header><strong>Status</strong></header>
        <div class="content" style="padding: 1rem;">
          <p id="toastMsg">-</p>
        </div>
        <footer style="display:flex; justify-content:flex-end; padding:.75rem 1rem;">
          <button onclick="document.getElementById('toast').close()">OK</button>
        </footer>
      </article>
    </dialog>

    <script>
      const $ = (id) => document.getElementById(id);
      function showToast(msg){ const p=$('toastMsg'); p.textContent = msg; $('toast').showModal(); }
      function showToastHtml(html){ const p=$('toastMsg'); p.innerHTML = html; $('toast').showModal(); }
      function ipv4ok(s){ const parts=(s||'').split('.').map(n=>+n); return parts.length===4 && parts.every(n=>Number.isInteger(n) && n>=0 && n<=255); }
      function phoneOk(s){ return /^\+\d{6,16}$/.test((s||'').trim()); }

      async function fetchJSON(url, options){ const r=await fetch(url, Object.assign({headers:{'Content-Type':'application/json'}}, options||{})); if(!r.ok) throw new Error(r.status+' '+r.statusText); return await r.json().catch(()=> ({})); }

      let currentSSID = "";

      async function loadInfo(){
        try{
          const j = await fetchJSON('/api/info');
          if (j && j.device_name) {
            $('deviceName').value = j.device_name;
          } else if (j && j.app && j.app.name) {
            $('deviceName').value = j.app.name;
          }
          
          if (j && j.notify){
            $('notifyEnabled').checked = !!j.notify.enabled;
            $('notifyPhone').value = j.notify.phone || '';
            $('notifyKey').value = j.notify.apikey || '';
            $('notifyBlock').classList.toggle('hidden', !$('notifyEnabled').checked);
          }

          try {
            const m = await fetchJSON('/api/mqtt');
            if (m) {
              $('mqttEnabled').checked = !!m.enabled;
              $('mqttServer').value = m.server || '';
              $('mqttPort').value = m.port || 1883;
              $('mqttUser').value = m.user || '';
              $('mqttPass').value = m.pass || '';
              $('mqttBlock').classList.toggle('hidden', !$('mqttEnabled').checked);
            }
          } catch (_) {}

          const net = j.network || {};
          currentSSID = net.ssid || '';
          
          const sel = $('wifiSSID');
          sel.innerHTML = '';
          if (currentSSID) {
            const opt = document.createElement('option');
            opt.value = currentSSID;
            opt.textContent = currentSSID + ' (gespeichert)';
            opt.selected = true;
            sel.appendChild(opt);
          } else {
            const opt = document.createElement('option');
            opt.value = "";
            opt.textContent = "W√§hle ein Netzwerk...";
            opt.disabled = true;
            opt.selected = true;
            sel.appendChild(opt);
          }
          const optManual = document.createElement('option');
          optManual.value = "__manual__";
          optManual.textContent = "Manuell eingeben...";
          sel.appendChild(optManual);

          $('pass').value = net.pass || '';
          $('useStatic').checked = !!(net.use_static);
          const st = (net.static) || {};
          $('ip').value = st.ip || '';
          $('mask').value = st.mask || '';
          $('gw').value = st.gw || '';
          $('dns').value = st.dns || '';
          $('staticBlock').classList.toggle('hidden', !$('useStatic').checked);
        }catch(_){ }
      }

      $('wifiSSID').addEventListener('change', (e) => {
        if (e.target.value === "__manual__") {
          $('ssidManual').classList.remove('hidden');
          $('ssidManual').focus();
        } else {
          $('ssidManual').classList.add('hidden');
        }
      });

      $('showPass').addEventListener('change', (e) => {
        $('pass').type = e.target.checked ? 'text' : 'password';
      });

      $('btnScan').addEventListener('click', async () => {
        const btn = $('btnScan');
        const sel = $('wifiSSID');
        btn.disabled = true; btn.textContent = "...";
        try {
          let nets = null;
          for (let i = 0; i < 15; i++) {
            const r = await fetch("/api/wifi/scan");
            if (r.status === 200) { nets = await r.json(); break; }
            await new Promise(res => setTimeout(res, 1000));
          }
          if (nets) {
            sel.innerHTML = '';
            if (currentSSID) {
              const opt = document.createElement('option');
              opt.value = currentSSID;
              opt.textContent = currentSSID + ' (gespeichert)';
              sel.appendChild(opt);
            }
            nets.sort((a,b) => b.rssi - a.rssi);
            const seen = new Set();
            if (currentSSID) seen.add(currentSSID);
            nets.forEach(n => {
              if (n.ssid && !seen.has(n.ssid)) {
                seen.add(n.ssid);
                const opt = document.createElement('option');
                opt.value = n.ssid;
                opt.textContent = `${n.ssid} (${n.rssi}dBm) ${n.secure?"üîí":""}`;
                sel.appendChild(opt);
              }
            });
            const optManual = document.createElement('option');
            optManual.value = "__manual__";
            optManual.textContent = "Manuell eingeben...";
            sel.appendChild(optManual);
            showToast("Scan abgeschlossen");
          }
        } catch (e) { showToast("Scan Fehler: " + e.message); }
        finally { btn.disabled = false; btn.textContent = "WLAN Scan"; }
      });

      async function updateSetupButton(){
        try{
          const st = await fetchJSON('/api/status');
          const growActive = !!(st && st.grow && st.grow.started);
          const dryingActive = !!(st && st.drying && st.drying.active);
          const canSetup = !growActive && !dryingActive;

          if (st.ap && st.ap.ssid && st.ap.ip) { $("apInfo").textContent = "AP: " + st.ap.ssid + " @ " + st.ap.ip; }

          const btn = $('btnSetup');
          if(canSetup){
            btn.style.pointerEvents = '';
            btn.style.opacity = '';
            btn.title = '';
          } else {
            btn.style.pointerEvents = 'none';
            btn.style.opacity = '0.4';
            btn.title = 'Setup nicht verf√ºgbar w√§hrend Grow oder Trocknung aktiv ist';
          }
        }catch(_){ }
      }

      $('useStatic').addEventListener('change', (e)=> $('staticBlock').classList.toggle('hidden', !e.target.checked));
      $('notifyEnabled').addEventListener('change', (e)=> $('notifyBlock').classList.toggle('hidden', !e.target.checked));
      $('mqttEnabled').addEventListener('change', (e)=> $('mqttBlock').classList.toggle('hidden', !e.target.checked));

      $('btnNameSave').addEventListener('click', async ()=>{
        const name = $('deviceName').value.trim();
        if(!name){ showToast('Bitte Namen eingeben'); return; }
        if(name.includes(' ')){ showToast('Name darf keine Leerzeichen enthalten'); return; }
        try{
          await fetchJSON('/api/app', { method:'POST', body: JSON.stringify({ name }) });
          showToast('Ger√§tename gespeichert');
        } catch(e){ showToast('Fehler: ' + e.message); }
      });

      $('btnNetSave').addEventListener('click', async ()=>{
        const selSSID = $('wifiSSID').value;
        const manualSSID = $('ssidManual').value.trim();
        const ssid = (selSSID === "__manual__") ? manualSSID : selSSID;
        const pass=$('pass').value;
        const useStatic=$('useStatic').checked;
        const ip=$('ip').value.trim();
        const mask=$('mask').value.trim();
        const gw=$('gw').value.trim();
        const dns=$('dns').value.trim();
        
        if(!ssid){ showToast('Bitte SSID w√§hlen oder eingeben'); return; }
        
        if(useStatic){
          for(const [val,label] of [[ip,'IP-Adresse'],[mask,'Subnetzmaske'],[gw,'Gateway']]){
            if(!ipv4ok(val)){ showToast('Ung√ºltige IPv4 in '+label); return; }
          }
          if(dns && !ipv4ok(dns)){ showToast('Ung√ºltige IPv4 in DNS'); return; }
        }
        const payload = { ssid };
        if(pass && pass !== "********") payload.pass = pass;
        payload.use_static = !!useStatic;
        payload.static = useStatic ? { ip, mask, gw, dns } : null;
        payload.reboot = true;
        
        showToastHtml('WLAN gespeichert. Das Ger√§t startet neu. Bitte jetzt ins Heimnetz wechseln und <a href="http://luminagrowx.local/" target="_blank">http://luminagrowx.local/</a> aufrufen.');
        try{ fetch('/api/network', {method:'POST', body: JSON.stringify(payload)}); }catch(_){ }
      });

      $('btnNotifySave').addEventListener('click', async ()=>{
        const enabled = $('notifyEnabled').checked;
        const phone = $('notifyPhone').value.trim();
        const rawKey = $('notifyKey').value.trim();
        const apikeySend = (rawKey === '' || rawKey === '***' || rawKey === '*******') ? null : rawKey;
        if (enabled) {
          if (!phoneOk(phone)) { showToast('Telefonnummer ist ung√ºltig (Format +49...)'); return; }
          if (!apikeySend) { showToast('API-Key fehlt'); return; }
        }
        const payload = { enabled, phone };
        if (apikeySend) payload.apikey = apikeySend;
        try{ await fetchJSON('/api/notify', { method:'POST', body: JSON.stringify(payload) }); showToast('Benachrichtigung gespeichert'); }
        catch(e){ showToast('Fehler beim Speichern: '+e.message); }
      });

      $('btnNotifyTest').addEventListener('click', async ()=>{
        const en=$('notifyEnabled').checked; const phone=$('notifyPhone').value.trim(); const key=$('notifyKey').value.trim(); const masked=(key===''||key==='***'||key==='*******');
        if(!en){ showToast('Benachrichtigungen sind deaktiviert'); return; }
        if(!phoneOk(phone)){ showToast('Telefonnummer ist ung√ºltig (Format +49...)'); return; }
        if(!masked && !key){ showToast('API-Key fehlt'); return; }
        const body = masked ? { phone } : { phone, apikey: key };
        try{ const r=await fetch('/api/notify/test',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)}); if(!r.ok) throw new Error(await r.text()); showToast('Testnachricht gesendet'); }
        catch(e){ showToast('Fehler beim Senden: '+e.message); }
      });

      $('btnMqttSave').addEventListener('click', async ()=>{
        const enabled = $('mqttEnabled').checked;
        const server = $('mqttServer').value.trim();
        const port = parseInt($('mqttPort').value.trim()) || 1883;
        const user = $('mqttUser').value.trim();
        const pass = $('mqttPass').value;
        
        if (enabled && !server) { showToast('Bitte Server-Adresse eingeben'); return; }
        
        const payload = { enabled, server, port, user, pass };
        try {
          await fetchJSON('/api/mqtt', { method:'POST', body: JSON.stringify(payload) });
          showToast('MQTT Einstellungen gespeichert');
        } catch(e) { showToast('Fehler: ' + e.message); }
      });

      $('btnSetup').addEventListener('click', () => {
        $('dlgSetupConfirm').showModal();
      });

      $('btnConfirmSetupRun').addEventListener('click', async () => {
        $('dlgSetupConfirm').close();
        try{
          const r = await fetch('/api/setup/reset', {method:'POST'});
          if (r.ok) {
            showToast('Inbetriebnahme Assistent wird gestartet. Das Ger√§t startet nun neu und er√∂ffnet ein eigenes WLAN. Du wirst in K√ºrze weitergeleitet...');
            setTimeout(()=> window.location.href = '/setup', 5000);
          } else {
            showToast('Fehler: ' + r.statusText);
          }
        } catch(e) {
          showToast('Fehler: ' + e.message);
        }
      });

      loadInfo();
      updateSetupButton();
    </script>
  </body>
</html>
